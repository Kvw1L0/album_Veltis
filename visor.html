<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gala VELTIS 2025 - En Vivo</title>
<style>
/* =========================================
1. EST√âTICA GENERAL (Fondo Oscuro y Dorado)
========================================= */
body {
background-color: #050505;
margin: 0;
padding: 0;
overflow-x: hidden;
font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
color: white;
min-height: 100vh;
}

    /* =========================================
       2. HEADER (Barra Superior Flotante)
       ========================================= */
    header {
        position: fixed;
        top: 0; 
        left: 0; 
        right: 0;
        background: linear-gradient(to bottom, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.7) 60%, transparent 100%);
        padding: 20px 40px;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(4px);
    }

    h1 {
        margin: 0;
        font-weight: 300;
        letter-spacing: 4px;
        text-transform: uppercase;
        color: #d4af37; /* Color Dorado */
        font-size: 1.8rem;
        text-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
    }

    /* Controles de Filtro (Derecha) */
    .controls-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    label {
        font-size: 0.9rem;
        color: #aaa;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    select {
        padding: 10px 20px;
        border-radius: 30px;
        background: rgba(255,255,255,0.1);
        color: #fff;
        border: 1px solid #d4af37;
        outline: none;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    select:hover {
        background: rgba(212, 175, 55, 0.2);
    }
    select option {
        background: #111;
        color: white;
    }

    /* =========================================
       3. MOSAICO INTELIGENTE (CSS GRID)
       ========================================= */
    .mosaic-grid {
        display: grid;
        /* Crea columnas autom√°ticas de m√≠nimo 280px */
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        grid-auto-rows: 280px; /* Altura base de cada fila */
        grid-auto-flow: dense; /* Algoritmo para rellenar huecos vac√≠os */
        gap: 15px;
        padding: 100px 40px 60px 40px; /* Padding top alto para no tapar con el header */
        opacity: 0;
        animation: pageFadeIn 1.5s ease-out forwards;
    }

    @keyframes pageFadeIn { to { opacity: 1; } }

    /* Estilos base de la tarjeta */
    .photo-item {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        background: #1a1a1a;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        opacity: 0; /* Empieza invisible */
        transform: translateY(30px);
        /* La animaci√≥n de entrada se define en JS para escalonarla */
        animation: itemPopIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    /* CLASES ESPECIALES PARA TAMA√ëOS (Estilo Google Photos) */
    .photo-item.wide { grid-column: span 2; } /* Ocupa 2 columnas */
    .photo-item.tall { grid-row: span 2; }    /* Ocupa 2 filas */
    .photo-item.big  { grid-column: span 2; grid-row: span 2; } /* Gigante 2x2 */

    /* Contenedor de la imagen */
    .img-wrapper {
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .photo-item img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Recorta la imagen para llenar el espacio */
        transition: transform 1s;
        will-change: transform;
    }

    /* Animaci√≥n Ken Burns (Zoom Lento) */
    .ken-burns {
        animation: kenBurnsAnim 20s infinite alternate linear;
    }

    @keyframes kenBurnsAnim {
        0% { transform: scale(1); }
        100% { transform: scale(1.2); }
    }

    /* Etiqueta de Categor√≠a (Overlay) */
    .label-overlay {
        position: absolute;
        bottom: 0; left: 0; right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
        padding: 20px 15px 15px 15px;
        transform: translateY(100%); /* Oculto abajo */
        transition: transform 0.4s ease;
    }

    /* Mostrar etiqueta al pasar el mouse */
    .photo-item:hover .label-overlay {
        transform: translateY(0);
    }

    /* Borde dorado al hacer hover */
    .photo-item::after {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        border: 2px solid #d4af37;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
        border-radius: 12px;
    }
    .photo-item:hover::after { opacity: 1; }

    .category-text {
        color: #d4af37;
        font-size: 0.85rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    @keyframes itemPopIn {
        to { opacity: 1; transform: translateY(0); }
    }

    /* =========================================
       4. PANTALLA DE CARGA
       ========================================= */
    #loading {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        transition: opacity 0.5s;
    }
    .spinner {
        width: 50px; height: 50px;
        border: 5px solid rgba(212, 175, 55, 0.3);
        border-top: 5px solid #d4af37;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

</style>


</head>
<body>

<!-- Pantalla de Carga -->
<div id="loading">
    <div class="spinner"></div>
    <div style="color: #888; letter-spacing: 1px;">CONECTANDO CON LA GALA...</div>
</div>

<!-- Header -->
<header>
    <h1>‚ú® Noche de Estrellas Veltis ‚ú®</h1>
    
    <div class="controls-wrapper">
        <label for="filtro">Filtrar:</label>
        <select id="filtro" onchange="renderPhotos()">
            <option value="todos">Ver Todo el √Ålbum</option>
            <option value="En mi traje de Gala">Traje de Gala</option>
            <option value="Con mi l√≠der favorito">L√≠der Favorito</option>
            <option value="Con un reconocido 2025">Reconocido 2025</option>
            <option value="Junto a La mesa de la noche">Mesa de la Noche</option>
            <option value="En la pista de Baile">Pista de Baile</option>
            <option value="Mi Gala en una Foto">Mi Gala</option>
        </select>
    </div>
</header>

<!-- Contenedor Principal del Mosaico -->
<div id="grid" class="mosaic-grid"></div>

<!-- =========================================
     5. L√ìGICA JAVASCRIPT Y FIREBASE
     ========================================= -->
<script type="module">
    // Importar funciones de Firebase (Versi√≥n 10.8.0)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, limit } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ---------------------------------------------------------
    // üî¥ IMPORTANTE: PEGA AQU√ç TU CONFIGURACI√ìN DE FIREBASE üî¥
    // ---------------------------------------------------------
    const firebaseConfig = {
        apiKey: "PEGA_TU_API_KEY_NUEVA_AQUI",
        authDomain: "TU_PROYECTO.firebaseapp.com",
        projectId: "TU_PROYECTO",
        storageBucket: "TU_PROYECTO.firebasestorage.app",
        messagingSenderId: "TUS_NUMEROS",
        appId: "TU_APP_ID"
    };

    // Inicializaci√≥n segura
    let db;
    try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        console.log("üî• Firebase conectado correctamente.");
    } catch (e) {
        console.error("Error iniciando Firebase:", e);
        document.getElementById('loading').innerHTML = `
            <h2 style="color:red">Error de Configuraci√≥n</h2>
            <p>No has pegado las credenciales nuevas en el c√≥digo.</p>
            <small>${e.message}</small>
        `;
    }

    let allPhotos = [];
    const grid = document.getElementById('grid');
    const loader = document.getElementById('loading');

    // Referencia a la colecci√≥n
    // Usamos 'limit(100)' para traer las √∫ltimas 100 fotos
    const q = query(collection(db, "fotos_gala"), orderBy("fecha", "desc"), limit(100));

    // Listener en Tiempo Real
    onSnapshot(q, (snapshot) => {
        // Ocultar pantalla de carga cuando llegue la primera respuesta
        loader.style.opacity = '0';
        setTimeout(() => loader.style.display = 'none', 500);

        if (snapshot.empty) {
            console.log("No hay fotos a√∫n en la base de datos.");
            return;
        }

        // Guardamos los datos en memoria
        allPhotos = [];
        snapshot.forEach(doc => {
            allPhotos.push({ id: doc.id, ...doc.data() });
        });

        // Renderizamos el mosaico
        renderPhotos();
    }, (error) => {
        console.error("Error leyendo BD:", error);
        if(error.message.includes("index")) {
            alert("‚ö†Ô∏è ATENCI√ìN: Firebase necesita crear un √≠ndice. Abre la consola (F12) y haz clic en el enlace largo que aparece en rojo.");
        }
    });

    // Funci√≥n Maestra de Renderizado
    window.renderPhotos = () => {
        const filtro = document.getElementById('filtro').value;
        
        // Limpiamos el grid
        grid.innerHTML = '';

        let delayCounter = 0;

        allPhotos.forEach((foto, index) => {
            // Filtrado por categor√≠a
            if (filtro !== 'todos' && foto.categoria !== filtro) return;

            // Crear contenedor de la foto
            const item = document.createElement('div');
            
            // --- Algoritmo de Mosaico Pseudo-Aleatorio ---
            // Patr√≥n: Normal, Normal, Ancho, Normal, Alto, Gigante, Normal...
            const pattern = ['normal', 'normal', 'wide', 'normal', 'tall', 'big', 'normal', 'wide', 'normal'];
            const sizeClass = pattern[index % pattern.length];
            
            item.className = `photo-item ${sizeClass}`;
            
            // Retraso de animaci√≥n (efecto cascada)
            item.style.animationDelay = `${delayCounter * 0.05}s`; 
            delayCounter++;

            // Generar direcci√≥n aleatoria para el Ken Burns
            const animDuration = 15 + Math.random() * 10; // Entre 15 y 25s
            const animDir = Math.random() > 0.5 ? 'alternate' : 'alternate-reverse';

            // Insertar HTML interno
            item.innerHTML = `
                <div class="img-wrapper">
                    <img src="${foto.url_foto}" 
                         class="ken-burns" 
                         style="animation-duration: ${animDuration}s; animation-direction: ${animDir}" 
                         loading="lazy" 
                         alt="Foto Gala">
                </div>
                <div class="label-overlay">
                    <div class="category-text">${foto.categoria}</div>
                </div>
            `;

            grid.appendChild(item);
        });
    };
</script>


</body>
</html>
